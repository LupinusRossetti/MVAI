# MV Production Automation Agent (Lupinus, Iris, Fiona)

> ⚠️ **重要（開発者・AIアシスタント向け）**: このプロジェクトを操作する前に、**必ず以下のファイルを読み込んでください**：
> - **`開発ルール.md`** - **開発者が必ず守るべきルール**（仕様変更時の履歴更新、作業開始前の確認、コミット・プッシュ前の確認など）
> - **`仕様書.md`** - システムの技術仕様、処理フロー、データ形式
> - **`CHANGELOG.md`** - 変更履歴（最新の変更内容を確認）
> - **`.cursorrules`** - Cursor用のプロジェクト固有ルール（開発ルールが埋め込まれています）
> 
> これらのファイルを読み込まないと、開発ルールに違反する可能性があります。

Streamlit/PythonベースのMV制作自動化パイプラインアプリケーション

## 概要

このアプリケーションは、ルピナス、アイリス、フィオナの三姉妹によるMV制作を目的とした自動化パイプラインです。手動でのAI生成作業とローカルでのメディア処理自動化を分離し、監督（ユーザー）が判断とクリエイティブな入力に集中できる環境を提供します。

## 機能

### 🤖 プロンプト生成アシスタント（対話形式）
- **対話形式のUI**: 専門用語が分からなくても、選択肢から選ぶだけでプロンプトを作成
- **豊富な選択肢**: カメラワーク、照明、ムード、被写体の動き、背景など多数の選択肢
- **分かりやすい選択肢**: 
  - 🎵 曲を生成するためのプロンプト（Suno AI用）
  - 🎬 MVの1シーンを作成するプロンプト（Sora/Grok/Luma用）
  - 🖼️ 動画シーンの基となる画像を作成するプロンプト（Grok Scene用）
- **詳細な活用方法ガイド**: 各プロンプトタイプの使い方、ソフトの起動方法、ダウンロード手順まで説明
- **使用モデル**: Gemini 1.5 Flash（無料枠で利用可能、クォータ超過を防止）

### 📁 自動フォルダ監視とメディア処理
- **01_曲_Input**: 音声ファイルのBPMとビートタイミング自動解析（librosa）
- **02_元動画_Sora**: 動画から静止画の自動抽出（ffmpeg）
- **04_AI動画_生成中**: 高品質化パイプラインのトリガー

## セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. FFmpegのインストール

FFmpegをシステムにインストールする必要があります。

- Windows: [FFmpeg公式サイト](https://ffmpeg.org/download.html)からダウンロード
- または: `choco install ffmpeg` (Chocolatey使用時)

### 3. アプリケーションの起動

**簡単な起動方法:**
- `start_app.bat`をダブルクリック
- ブラウザが自動的に開きます

**手動で起動する場合:**
```bash
cd C:\MVAI
streamlit run app.py
```

**停止方法:**
- ブラウザを閉じる
- バッチファイルを実行したウィンドウで `Ctrl+C` を押す

### 4. Gemini API Keyの設定

1. [Google AI Studio](https://aistudio.google.com/) にアクセス
2. API Keyを生成
3. アプリケーションのサイドバーでAPI Keyを入力

## フォルダ構成

アプリケーションは起動時に以下のフォルダを自動作成します：

```
C:\MVAI\
├── 01_曲_Input          # Suno曲の入力
├── 02_元動画_Sora        # Adobe Sora/Fireflyの動画入力
├── 03_静止画_選定        # キーフレーム自動抽出結果
├── 04_AI動画_生成中      # Grok/Luma等の6秒クリップ入力
│   └── 使用済み素材       # 処理済みの素材
├── 05_動画_高品質化      # Upscale/補間後の出力
│   └── 使用済み素材       # 処理済みの素材
├── 06_動画_口パク        # リップシンク処理後の出力
│   └── 使用済み素材       # 処理済みの素材
├── 98_MV_完成品          # 完成したMVの出力先
├── 99_MV_編集素材        # 最終処理済み素材（06で処理された動画ごとにセットフォルダを作成）
│   ├── [動画名1]/        # 動画ファイル名をベースにしたセットフォルダ
│   │   ├── [動画ファイル].mp4
│   │   └── [動画名]_metadata.xml
│   ├── [動画名2]/
│   │   ├── [動画ファイル].mp4
│   │   └── [動画名]_metadata.xml
│   └── 音声ファイル/     # 処理済み音声ファイル（共通）
└── 99_Logs              # 解析ログCSV、処理ログの出力
```

## 使用方法

### 最初のステップ

1. **Gemini APIキーを設定**
   - サイドバーでAPI Keyを入力

2. **曲を配置**
   - `01_曲_Input`フォルダに音声ファイルを配置
   - 自動的にBPMとビートタイミングが解析され、`99_Logs`にCSVが出力されます

3. **プロンプトを生成**
   - 「プロンプト生成」タブを開く
   - プロンプトタイプを選択（曲生成、MVシーン作成、画像生成）
   - 各項目の選択肢から希望を選択
   - 「プロンプトを生成」ボタンをクリック
   - 生成されたプロンプトをコピーして、各AIツールで使用
   - 各プロンプトタイプの詳細な使い方は、選択後に表示されるガイドを参照

### ワークフロー

1. **音声処理**: `01_曲_Input`に音声ファイルを配置 → 自動解析 → `99_MV_編集素材`に移動
2. **動画処理**: `02_元動画_Sora`に動画ファイルを配置 → 静止画自動抽出
3. **AI動画生成**: 生成した動画を`04_AI動画_生成中`に配置 → 高品質化パイプライン準備
4. **MV自動生成**: 「🎵 MV自動生成」タブで動画クリップと音声を選択 → `98_MV_完成品`に保存

## 技術スタック

- **Streamlit**: Web UIフレームワーク
- **Watchdog**: ファイルシステム監視
- **Librosa**: 音声解析（BPM、ビート検出）
- **FFmpeg-python**: 動画処理
- **Google Generative AI**: プロンプト生成

## トラブルシューティング

- **エラーが出る場合**: 以下のコマンドで依存関係を再インストール
  ```bash
  pip install -r requirements.txt
  ```

- **FFmpegがインストールされているか確認**:
  ```bash
  ffmpeg -version
  ```

## 注意事項

- 高品質化処理はFFmpegを使用した解像度アップスケールとフレームレート補間を実装済みです
- リップシンク処理は現在ファイルコピーのみです。実際のリップシンク処理を実装する場合は、Wav2LipやSadTalkerなどのツールを統合してください

## ドキュメント

### 📖 詳細ドキュメント

- **`仕様書.md`** - システムの技術仕様、処理フロー、データ形式など
- **`操作説明書.md`** - アプリケーションの使い方、ワークフロー例、よくある質問
- **`README_最終素材の使い方.md`** - 最終処理済み素材の使い方、編集ソフトでの活用方法
- **`開発ルール.md`** - **開発者が必ず守るべきルール**（重要）
- **`CHANGELOG.md`** - 変更履歴

### 📚 クイックリファレンス

- **初回セットアップ**: `操作説明書.md`の「初回セットアップ」セクション
- **基本的な使い方**: `操作説明書.md`の「基本的な使い方」セクション
- **技術的な詳細**: `仕様書.md`を参照
- **開発ルール**: `開発ルール.md`を**必ず読んでください**

## 開発者向け

### ⚠️ 重要: 開発ルール

このプロジェクトを操作する際は、**必ず`開発ルール.md`を読んで、ルールを守ってください**。

主なルール：
1. **仕様変更やコード修正後は、必ず`仕様書.md`と`CHANGELOG.md`を更新**
2. **作業開始前に最新のプッシュを確認し、必要に応じてプル**
3. **コミット・プッシュ前に内容を必ず確認**

詳細は`開発ルール.md`を参照してください。

## ライセンス

このプロジェクトはMV制作のための内部ツールです。

