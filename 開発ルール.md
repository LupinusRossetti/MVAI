# MV Production Automation Agent 開発ルール

このプロジェクトを操作する際は、**必ず以下のルールを守ってください**。

## 📋 必須ルール

### 1. 仕様および変更履歴の管理

**仕様変更やコード修正を行った際は、必ず履歴に追加してください。**

- **仕様書**: `仕様書.md` を更新
- **変更履歴**: `CHANGELOG.md` に変更内容を追加

#### 変更履歴の記録方法

`CHANGELOG.md`に以下の形式で記録してください：

```markdown
## [YYYY-MM-DD] - 変更内容の概要

### 追加
- 新機能の説明

### 変更
- 既存機能の変更内容

### 修正
- バグ修正の内容

### 削除
- 削除した機能の説明
```

**重要**: 仕様変更やコード修正を行った後、履歴を更新するのを忘れないでください。

---

### 2. 作業開始前の最新状態確認

**新しく操作を始める時は、必ず最新のプッシュを確認してから作業を開始してください。**

#### 手順

1. **リモートの最新状態を確認**
   ```bash
   git fetch origin
   git status
   ```

2. **最新のプッシュがある場合、必ずプルする**
   ```bash
   git pull origin master
   ```

3. **プル後にコンフリクトがないか確認**
   - コンフリクトがある場合は解決してから作業を開始

**重要**: 最新の状態を取得せずに作業を開始すると、他の人の変更と競合する可能性があります。

---

### 3. コミット・プッシュ前の確認

**コミットやプッシュを行う際は、必ず内容を確認してから実行してください。**

#### 確認チェックリスト

コミット・プッシュ前に以下を確認してください：

- [ ] 変更内容が正しいか
- [ ] 不要なファイルが含まれていないか（`.gitignore`を確認）
- [ ] APIキーや機密情報が含まれていないか
- [ ] 仕様書や変更履歴を更新したか
- [ ] テストが通るか（可能な場合）
- [ ] コミットメッセージが適切か

#### コミット前の確認コマンド

```bash
# 変更内容を確認
git status
git diff

# ステージングされた内容を確認
git diff --cached

# コミットメッセージを確認
git commit -m "適切なコミットメッセージ"
```

#### プッシュ前の確認

プッシュする前に、以下のコマンドで内容を再確認：

```bash
# コミット履歴を確認
git log --oneline -5

# プッシュする内容を確認
git log origin/master..HEAD
```

**重要**: プッシュ前に「この内容でプッシュして本当に間違いないか」を必ず確認してください。

---

## 🔒 セキュリティルール

### APIキーと機密情報

- **絶対にコミット・プッシュしないもの**:
  - `.api_key.json`
  - `.characters.json`
  - `.prompt_history.json`
  - `.favorite_prompts.json`

- **確認方法**:
  ```bash
  git status
  # 上記のファイルが表示されないことを確認
  ```

### 大きなファイル

- GitHubの100MB制限を超えるファイルは自動的に除外されます
- メディアファイル（動画、音声、画像）は`.gitignore`で除外されています

---

## 📝 コミットメッセージの規則

### 形式

```
[種類] 変更内容の簡潔な説明

詳細な説明（必要に応じて）
```

### 種類

- `[追加]`: 新機能の追加
- `[変更]`: 既存機能の変更
- `[修正]`: バグ修正
- `[削除]`: 機能の削除
- `[リファクタ]`: コードの整理・改善
- `[ドキュメント]`: ドキュメントの更新

### 例

```
[追加] MV自動生成機能を実装

- 複数の動画クリップを結合する機能を追加
- ビート同期機能を実装
- 音声トラックの追加機能を実装
```

---

## 🚀 推奨ワークフロー

### 1. 作業開始時

```bash
# 1. 最新の状態を取得
git fetch origin
git pull origin master

# 2. ブランチを作成（必要に応じて）
git checkout -b feature/新機能名
```

### 2. 作業中

- 定期的にコミット（小さな単位で）
- 仕様変更があれば`仕様書.md`を更新
- 変更があれば`CHANGELOG.md`に記録

### 3. 作業完了時

```bash
# 1. 変更内容を確認
git status
git diff

# 2. ステージング
git add .

# 3. コミット（内容を確認してから）
git commit -m "[種類] 変更内容"

# 4. プッシュ前の最終確認
git log origin/master..HEAD

# 5. プッシュ（本当に間違いないか確認してから）
git push origin master
```

---

## ⚠️ 注意事項

1. **必ず最新の状態を取得してから作業を開始する**
2. **仕様変更やコード修正後は必ず履歴を更新する**
3. **コミット・プッシュ前に必ず内容を確認する**
4. **APIキーや機密情報をコミットしない**
5. **大きなファイルをコミットしない**

---

## 📚 関連ドキュメント

- `仕様書.md` - システムの技術仕様
- `CHANGELOG.md` - 変更履歴
- `操作説明書.md` - アプリケーションの使い方
- `README.md` - プロジェクト概要

---

**これらのルールを守ることで、チーム全体で安全かつ効率的に開発を進めることができます。**

